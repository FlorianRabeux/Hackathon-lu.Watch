{
  "_from": "sap-e2e-trace@>=1.0.3 <2.0.0",
  "_id": "sap-e2e-trace@1.0.3",
  "_nodeVersion": "4.4.7",
  "_npmUser": {
    "email": "xmake@sap.com",
    "name": "deploy.releases.npm"
  },
  "_npmVersion": "2.15.8",
  "_shasum": "d2d18fa177f89136c966766d509c8d2285f5c9ce",
  "dependencies": {
    "lodash": "3.10.1"
  },
  "description": "Provides functionalities for handling SAP Passports",
  "devDependencies": {
    "chai": "2.3.0",
    "eslint": "1.4.3",
    "filter-node-package": "^1.1.0",
    "istanbul": "0.3.14",
    "mocha": "2.2.5",
    "node-style": "1.1.2"
  },
  "dist": {
    "shasum": "d2d18fa177f89136c966766d509c8d2285f5c9ce"
  },
  "engines": {
    "node": "^0.12.7 || ^4.4.0 || ^6.0.0",
    "npm": "^2.11.x"
  },
  "files": [
    "lib",
    "package.json",
    "diagram.png",
    "README.md",
    "index.js"
  ],
  "main": "index.js",
  "maintainers": [
    {
      "name": "deploy.releases.npm",
      "email": "xmake@sap.com"
    }
  ],
  "name": "sap-e2e-trace",
  "readme": "# sap-e2e-trace\n\nProvides functionalities for handling SAP Passports.\n\n\n## Overview\n\nSAP Passports allow to identify a specific request in an end-to-end scenario involving several components communicating with each other.\nThis is especially helpful in the task of following the state of a business transaction across different systems.\nTo achieve that, the client should send a special header ('sap-passport') containing the SAP Passport to the first component.\nThe SAP Passport is a hex string with a special structure. The client can send one via a browser plugin or via SAPUI5 application frontend.\nWhenever an SAP Passport comes into a component, this component should also include the unique identifiers of the SAP Passport in its logs/traces,\nupdate it with component specific data and then forward it to the next system.\n\nSee the diagram below:\n\n![SAP Passport overview diagram](diagram.png \"Overview diagram\")\n\nAn application receives an SAP Passport in the 'sap-passport' header. The same header is used when the SAP Passport is getting forwarded over the HTTP protocol to another system.\nIf it is being sent to HANA, the SAP Passport should be set as the 'SAP_PASSPORT' session variable of the database connection.\n\n## API\n\n- Loading the package:\n\n```js\nvar SAPPassport = require('sap-e2e-trace').Passport;\n```\n\n- Creating an SAP Passport instance\n\n```js\nfunction requestHandler(req, res) {\n  var encodedPassport = req.headers[SAPPassport.HEADER_NAME];\n  if (encodedPassport) {\n    var passport = new SAPPassport(encodedPassport);\n  }\n}\n```\n\nThe library provides a constant for the 'sap-passport' header: `SAPPassport.HEADER_NAME`.\n\nThe `passport` variable is an instance with which you may read/modify the SAP Passport in your component.\n\n- Reading the unique identifiers of an SAP Passport\n\n```js\nvar identifiers = passport.readUniqueIdentifiers();\n```\n\nThe returned value (assigned to the `identifiers` variable) is an object that has the following properties: `transactionID`, `rootContextID`, `connectionID`, `connectionCounter`.\nThese SAP Passport fields got to be present in the logs/traces of the component.\nIf you are using the `sap-logging` library, refer to its documentation to check whether the specific version is capable of handling SAP Passports or not.\n\n\n- Updating the SAP Passport - this is done right before forwarding it to the next component.\n\n```js\npassport.update({\n  previousComponent: 'my-application',\n  connectionID: '00112233445566778899AABBCCDDEEFF',\n  connectionCounter: 36\n});\n```\n\nThis method takes an object with the following properties (all of them are mandatory):\n\nProperty      | Value      | Semantics\n------------- | ---------- | --------------------------\n`previousComponent` | ASCII string. Up to 32 characters. | This is the name of the current component which is about to make an outbound connection to another component.\n`connectionID` | GUID, 16-byte hex | Every connection between the current component and the next component should have an ID which is passed as that property.\n`connectionCounter`| Positive integer, up to 4 bytes | States for which time the connection with the given `connectionID` is being reused.\n\n- Compacting the SAP Passport - HANA DB has a limitation over the SAP Passport size.\nThis is why it is recommended to call the method `compact` before forwarding an SAP Passport to HANA.\n\n```js\npassport.compact();\n```\n\n- Generating a hex string out of the updated SAP Passport - the SAP Passport can be send to other components in this format.\n\n```js\nvar http = require('http');\nvar url = require('url');\n\nvar encodedPassport = passport.serialize();\n\nvar options = url.parse('http://my-host:1234/my/path');\noptions.headers = {};\noptions.headers[SAPPassport.HEADER_NAME] = encodedPassport;\n\nvar request = http.request(options);\nrequest.on('error', function (err) { /* ... */ });\nrequest.on('response', function (response) { /* ... */ });\nrequest.end();\n```\n",
  "readmeFilename": "README.md",
  "scripts": {
    "lint": "eslint -c node_modules/node-style/.eslintrc -f stylish lib/",
    "prepareRelease": "clean-packages && npm prune --production",
    "test": "node node_modules/istanbul/lib/cli.js cover node_modules/mocha/bin/_mocha test -- --recursive --check-leaks"
  },
  "version": "1.0.3"
}