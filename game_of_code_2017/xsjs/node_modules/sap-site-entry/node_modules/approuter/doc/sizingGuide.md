Sizing Guide for Application Router
===================================

In this guide we provide measurements we did in different application router usage scenarios, which you can use to calculate approximately the amount of memory the application router would require. The tables contain the exact results of the measurements with Node.js v4.2.4. For productive usage probably is a good idea to provide a bit higher numbers.

All measurements are with authentication. If you have additional session content and want to count the session memory consumption please take a look at what is stored in the session - described in README's [Session Contents](../README.md#session-contents) section. You will need to add the calculated session size taking into account the number of different users and the session timeout. In our tests only the JWT token took ~4KB.

## Idle
The memory consumption for an idle application router is around 50 MB.

## For HTTP traffic:

Parallel users | Payload (KB) | Memory Consumption (MB)
----------- | --------| -----------------------
10  | 1 | 105
10  | 5 | 110
10  | 20 | 110
20  | 1 | 120
20  | 5 | 125
20  | 20 | 125
100 | 1 | 185
100 | 5 | 200
100 | 20 | 200

## For web socket traffic:

Connections | Payload (KB) | Memory Consumption (MB)
----------- | --------| -----------------------
100 | 1 | 100
100 | 10 | 100
200 | 1 | 135

## Memory Configuration

Application Router process should run with at least 256MB memory. It may require more memory depending on the application.
These aspects influence memory usage:
- concurrent connections
- active sessions
- JWT token size
- backend session cookies

If Application Router is running in an environment with limited memory like Cloud Foundry or Docker, you should limit its heap to about 75% of available memory.
For example if Application Router memory is limited to 256MB, use this command in your `package.json`:
```
    "scripts": {
        "start": "node --max-old-space-size=192 node_modules/approuter/approuter.js"
    }
```

