'use strict';
const jwtDecode = require("jwt-decode")

class UserService {
    constructor() {
    }
    
    static getUser(session) {
        return new Promise((resolve, reject) => {
            var user = session.user || {};
            var userName = user.name ? user.name : "Anonymous";
            user.userName = userName;
            resolve(user);
        });
    }


    static getUserWithAuth(session) {
        return new Promise((resolve, reject) => {
            let token = session.user.token.accessToken,
                userContext = this.getUserContext(token);

            if(userContext) {
                resolve(userContext);
            } else {
                reject(new Error("user not found"));
            }
        });
    }

    static getUserContext(token) {
        let userContext;
        try {
            let decoded  =  jwtDecode(token);
            userContext = {
                "userName": decoded["user_name"],
                "scopes": decoded["scope"],
                "userAttributes": decoded["xs.user.attributes"]
            }
        } catch(err) {
            console.error(err.message);
        }
        return userContext
    }
}



module.exports = UserService;
